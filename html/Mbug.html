<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
</head>
<html>
<body>
<div class="container">

<h1 id="0">Mbug (Mar 19, 2005)</h1><a href="index.html">(home)</a><hr><ol>
<li><a class="link" href="#1">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 20, 2005</a></li>
<li><a class="link" href="#2">From: "John R. Hogerhuis" <jhoger@...> Mar 21, 2005</a></li>
<li><a class="link" href="#3">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 21, 2005</a></li>
<li><a class="link" href="#4">From: "John R. Hogerhuis" <jhoger@...> Mar 22, 2005</a></li>
<li><a class="link" href="#5">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 22, 2005</a></li>
<li><a class="link" href="#6">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 22, 2005</a></li>
<li><a class="link" href="#7">From: "John R. Hogerhuis" <jhoger@...> Mar 22, 2005</a></li>
<li><a class="link" href="#8">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 24, 2005</a></li>
<li><a class="link" href="#9">From: "John R. Hogerhuis" <jhoger@...> Mar 24, 2005</a></li>
<li><a class="link" href="#10">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 24, 2005</a></li>
<li><a class="link" href="#11">From: "John R. Hogerhuis" <jhoger@...> Mar 25, 2005</a></li>
<li><a class="link" href="#12">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 25, 2005</a></li>
<li><a class="link" href="#13">From: "John R. Hogerhuis" <jhoger@...> Mar 25, 2005</a></li>
<li><a class="link" href="#14">From: "John R. Hogerhuis" <jhoger@...> Mar 25, 2005</a></li>
<li><a class="link" href="#15">From: "John R. Hogerhuis" <jhoger@...> Mar 25, 2005</a></li>
<li><a class="link" href="#16">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 25, 2005</a></li>
<li><a class="link" href="#17">From: "John R. Hogerhuis" <jhoger@...> Mar 25, 2005</a></li>
<li><a class="link" href="#18">From: "Cyrano Jones" <cyranojones_lalp@...> Mar 28, 2005</a></li>
<li><a class="link" href="#19">From: "John R. Hogerhuis" <jhoger@...> Mar 31, 2005</a></li>
<li><a class="link" href="#20">From: "Cyrano Jones" <cyranojones_lalp@...> Apr 1, 2005</a></li>
<li><a class="link" href="#21">From: "Cyrano Jones" <cyranojones_lalp@...> Apr 8, 2005</a></li>
<li><a class="link" href="#22">From: "John R. Hogerhuis" <jhoger@...> Apr 8, 2005</a></li>
<li><a class="link" href="#23">From: "Neil Morrison" <neilsmorr@...> Apr 8, 2005</a></li>
<li><a class="link" href="#24">From: "Cyrano Jones" <cyranojones_lalp@...> Apr 9, 2005</a></li>
<li><a class="link" href="#25">From: "Cyrano Jones" <cyranojones_lalp@...> Apr 9, 2005</a></li>
<li><a class="link" href="#26">From: "John R. Hogerhuis" <jhoger@...> Apr 9, 2005</a></li>
</ol><hr>
<hr><h3>Subject: Mbug</h3>
<p class="from">From: Brad Fayette &lt;bfayette@...></p>
<p class="date">Mar 19, 2005</p>
<p class="formattedBody">I should have figured that out about the power.  I guess there is some<br>
work left to do :-)<br>
<br>
I am running it on a Toshiba T4700CS laptop, 50mhz 486, Win 95.  Runs<br>
fine in a dos window.<br>
<br>
I am seeing comments when I disassemble.  I assume the code is coming<br>
out of the mailstation, and the comments out of a file. I guess this is<br>
something to be aware of in case you change something.<br>
<br>
Do you have any advice on how not to trash the mailstation when<br>
writing/loading/running applications?<br>
<br>
Does the mailstion 250 have a Z80?  I have a 350, but it has some<br>
toshiba 16 bit processor, so I'm getting rid of it.  The interesting<br>
thing is that for wireless devices, the FCC has tons of stuff online,<br>
like schematics.  All you need is the FCC Id. Maybe some of it for the<br>
250 would apply to other devices as well.<br>
<br>
CJ, where are you located?  I'm in North Carolina, USA.<br>
<br>
Regards,<br>
<br>
Brad Fayette<br>
"The geeks shall inherit the Earth."<br>
<br>
</p>
<hr><h3 id="1">1: Subject: Re: Mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 20, 2005</p>
<p class="formattedBody">wrote:<br>
<br>
It won't be hard to get it to shut off, I just<br>
haven't tried.  Actually, I don't think it ever<br>
really shuts itself off in "normal" use,  I think<br>
it just "goes to sleep".<br>
<br>
Try "G 1AC0"<br>
That will execute what I believe the ms does<br>
when it "turns off".  My screen went blank when<br>
I tried it!  I thought I would have to power cycle<br>
or reset to get it back, but the power button<br>
wakes it up!!!<br>
<br>
I actually leave mine on most of the time, running<br>
with the wall-wart.   (And that has been how I<br>
killed 3 of the 4.)  If you are using batteries, I<br>
guess you need to take them out to get it<br>
completely off.<br>
<br>
<br>
That's cool.  I hadn't even thought about that end<br>
of the spectrum. :-)    How much ram is in it?<br>
The debugger allocates over 3 meg of buffers,<br>
and it probably should run with a disk cache<br>
(win 95 provides one, right???) because the comment<br>
files are not buffered inside of the program<br>
(and it reads them from the beggining every<br>
time screen scrolls.)<br>
<br>
<br>
Right.  If you installed the v2.53 files, and converted<br>
to .rom files, then you can use the "ram" target, and<br>
browse the disassembly/comments, and the code<br>
will be read from pc ram, and it is noticeably<br>
faster.  I started to add the concept of "projects"<br>
so you could have different versions use different<br>
comment files, but that is not done yet.<br>
<br>
I'm just distributing the comment files, without<br>
the disassembly, because I don't want to<br>
worry about any copyright issues.<br>
<br>
If you use command ^h it will render the disassembly<br>
and comments to a hyperlinked .html files.  I don't<br>
know how long it will take at 50 MHz to do pages<br>
00 thru 3f, but you can tell it to do just page 00.<br>
(I recommend using ram target for this.  But it<br>
should work from mbug, just slower.)<br>
<br>
<br>
The first one I trashed was due to me asking the<br>
debugger to erase a page that held part of the<br>
then-current bootup code.  The only way to avoid<br>
that is to be careful.  :-)  :-)<br>
<br>
The second and third were due to changes I<br>
made to keep the mailstation from getting locked up<br>
when rebooting the PC.  Previously it had<br>
been thru countless reboots, with the<br>
only ill effect being that it was unresponsive to<br>
commands, and required a hard reset.<br>
<br>
I was getting tired of having to<br>
poke a pencil in the reset hole.  I<br>
figured what was happening was that<br>
either windows or the PC firmware was<br>
"printing" some garbage to the parallel port<br>
during boot up (you know how a printer will<br>
sometimes print garbage when a PC is booting.)<br>
So, I added some error detection, making<br>
the remote code restart whenever it got<br>
a command that didn't make sense.  All I<br>
can figure is that what happened is that<br>
I gave the gibberish a fresh shot from<br>
the start everytime it sent nonsense,<br>
making it much more likely to hit on the<br>
command "erase page 00" eventually.<br>
<br>
The first time it happened I really didn't<br>
know what had happened.  I grabbed a<br>
new mailstation, and installed the very same<br>
version of mboot.  Within a week that one<br>
was toast, too.  I figured it must have something<br>
to do with the most recent changes.  So<br>
I decided I should fix it before wrecking<br>
another mailsation.  In the meantime, I<br>
was fiddling with a stock mailstation<br>
(without my code) trying to read the serial<br>
number thru the laplink (that works!).<br>
<br>
But I left the thing connected (and powered)<br>
when I was done.  Several days went by,<br>
with several pc reboots, and then one day<br>
I noticed that this *stock* mailstation<br>
had apparently gotten erased.  Live and learn.<br>
<br>
I now *unplug* the laplink when I quit<br>
the debugger (It now displays a<br>
reminder when quitting!)<br>
I actually thought I had fixed it<br>
so this couldn't happen, but as I<br>
look at the code now, it appears that<br>
the reminder is how I fixed it.<br>
If only I had the time to do everything I<br>
want to...<br>
<br>
But I havent had any problem since<br>
December.  The next version should<br>
have a better safeguard.<br>
<br>
There really is no way to prevent<br>
a haywire program from finding the reflash<br>
code, other than removing it completely.<br>
I mean, even if you thought you had<br>
a secure lockout, what if the program<br>
running amok jumps in right after the lock?<br>
But I don't think we really need to worry<br>
about that.  Just unplug the laplink when<br>
you are done, for now!  And brown<br>
mailstations are real cheap on ebay. :-)<br>
<br>
<br>
Yes.  It's essentially the same as the<br>
brown/white/100's.  Except for the<br>
modem, and the radio circuitry.  And<br>
keyboard.  And callerid chip.  But the<br>
cpu/ram/codeflash/dataflash are the same.<br>
<br>
<br>
I'll bet you can get over $100 for it on<br>
ebay.  I've seen several sell in the $130 range.<br>
<br>
The 350 appears to use some other<br>
protocol (if any) for it's update function.<br>
<br>
<br>
Yes!  Where is the search page?  I saw the link<br>
on linux hacker for the 350 data.  But I can't<br>
find a search page that will return that page.<br>
Is there any reason we shouldn't look at this,<br>
like with the patent info?<br>
<br>
We already have most of the port/pinout/address info<br>
courtesy of rogblake, and one friendly panther<br>
(who I understand almost went blind tracing the circuit).<br>
<br>
<br>
I'm in the Detroi..... Uh, I mean I'm in my ship, hovering<br>
500 miles over the Detroit area, safely out of reach of<br>
any Earth regulations such as DMCA (or even YMCA!)<br>
Don't let my ip address fool you, I'm attached to<br>
some earthlings open wi-fi link.  Yeah, that's it.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="2">2: Subject: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 21, 2005</p>
<p class="formattedBody">I got source for mailbug some time back, and I've built it for Linux.<br>
<br>
No luck burning mbug into the flash though.<br>
<br>
Do I have to put the MS into a special mode before running the flash<br>
burn software?<br>
<br>
Fn-Shift-T gets me to a diagnostics menu, but there is no entry there<br>
regarding flash programming (just various tests).<br>
<br>
<br>
</p>
<hr><h3 id="3">3: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 21, 2005</p>
<p class="formattedBody">Linux.<br>
<br>
Great!  How did you handle the port permission issue???<br>
<br>
<br>
No, just turn it on.  As far as I can tell, the ms can<br>
be on any screen when you kick it into the update mode.<br>
You do not need to touch the mailstation (other than<br>
to turn it on, and connect the laplink).<br>
<br>
The PC will make the ms enter/leave update mode<br>
via the laplink.  The only commands you need to<br>
type are on the PC keyboard.<br>
<br>
When the update is done, the ms reboots to the<br>
main menu, unless you erased the ms code.<br>
<br>
Make sure you can read out the serial number<br>
before you try to flash.  That will tell you if<br>
you are sending and receiving ok.  Each time<br>
you read sn, it will enter update mode, display<br>
sn on pc screen, and then the ms reboots when<br>
the update mode exits.<br>
<br>
Maybe there exists a need for some documentation???   ;^)<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="4">4: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 22, 2005</p>
<p class="formattedBody">On Tue, 2005-03-22 at 03:13 +0000, Cyrano Jones wrote:<br>
<br>
uses oldlinux;<br>
<br>
iopl(3);<br>
ioperm (888,2,1);<br>
<br>
<br>
Crap... I was afraid of that... that means one of the following:<br>
<br>
1) laplink cable problem (I bought a manufactured cable) or<br>
2) Timing issue or<br>
3) The bytes aren't really making it out the port or<br>
4) There's something broken about my serial port<br>
<br>
<br>
Uh, well that would help. Also if you have any debugging ideas, that<br>
would be cool.<br>
<br>
<br>
</p>
<hr><h3 id="5">5: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 22, 2005</p>
<p class="formattedBody"><br>
I don't think you need the iopl(3),<br>
just the ioperm(888,2,1).  888 is the decimal address of lpt1,<br>
the 2 means 2 consecutive ports, and I believe 888 & 889<br>
are all I used.  And the one means "grant access", right???<br>
And I think you have to be root to do the ioperm.<br>
<br>
Are you USEing the plain "linux" unit (I think that is the name)???<br>
None of the examples I see mention the "oldlinux",<br>
and I think ioperm is in "linux".  Maybe it just a newer<br>
version than in "oldlinux".  What's the scoop on why<br>
oldlinux is necessary???<br>
<br>
As far as I can tell, after the ioperm, you can use the ports<br>
unit, and that's what unit_tribbles uses for port access.<br>
<br>
Do you know for sure what the port address is for your<br>
parallel port????  888 is the most common, but there<br>
are others.  I think we have another candidate for the config<br>
file!!!!<br>
<br>
[snip]<br>
<br>
<br>
Can you test the port with some other software?  (And<br>
a printer).<br>
<br>
Are you sure it is Parallel Laplink and not serial???<br>
They make both!<br>
<br>
What do you get on your screen???  Any timeout errors?<br>
<br>
You could try making a simple test program that<br>
toggles the dataport pins, and check with logic<br>
probe (or LED port tester thingy), and see if<br>
that works (eliminates cable and mailstation from<br>
the equation).<br>
<br>
But the first thing I would try is skipping oldlinux & the iopl(3).<br>
<br>
<br>
I think we are figuring out the docs as we go!!!  We<br>
can compile the questions, or at least answers into<br>
some kind of manual.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="6">6: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 22, 2005</p>
<p class="formattedBody">OK.  I see what the oldlinux is about.  They did away<br>
with the linux unit.  And replaced it with a handful of<br>
other units.  I found the new ioperm in unit "X86".<br>
<br>
But apparently "oldlinux" *IS* the "linux" unit, renamed.<br>
And it should work.  But I found this in the oldlinux<br>
manual:<br>
IoPL<br>
Set I/O privilege level<br>
Declaration<br>
Source position: linuxold.inc line 1558<br>
function IoPL(<br>
Level: LongInt<br>
):Boolean;<br>
<br>
Description<br>
IoPL sets the I/O privilige level. It is intended for completeness<br>
only, one should normally not use it.<br>
<br>
How do you call ioperm???  Does it return error???<br>
It should return "true" if it worked, and "false"<br>
if it failed.  Do you check it???<br>
<br>
writeln('gonna ask for ioperm...');<br>
<br>
if not (ioperm(888, 3, 1)) then<br>
begin<br>
writeln('didn''t get it.  damn.  gonna halt now.');<br>
Halt(1);<br>
end;<br>
<br>
writeln('Hot dang!  We got it!!!');<br>
delay(1000);<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="7">7: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 22, 2005</p>
<p class="formattedBody">On Tue, 2005-03-22 at 07:32 +0000, Cyrano Jones wrote:<br>
<br>
It didn't work until I put the iopl in. I didn't think I needed it<br>
either, but I was getting access violations until I put it in.<br>
<br>
<br>
Yeah I was ignoring the return code. Your way is better in case someone<br>
decides to run it and they aren't root you can give them an error<br>
message.<br>
<br>
<br>
</p>
<hr><h3 id="8">8: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 24, 2005</p>
<p class="formattedBody">Any luck yet?<br>
<br>
<br>
You meant parallel, right???  :-)<br>
<br>
It just occured to me that the port tester I used was<br>
for rs232.  All 25 pins go straight thru, and the 9<br>
lines used by rs232 have leds.<br>
<br>
7 of the 10 laplink signals fall on a line with led,<br>
and the 5 laplink-out bits are on the first 5 leds.<br>
I eventually modified it so all 10 laplink signals<br>
were monitored with a led, but it was extremely<br>
useful even before mod.<br>
<br>
The PC will use pins 2, 3, 4, 5, 6 to talk *to* the<br>
mailstation.  2, 3, 4 are the 3 bit tribble, 5 is busy,<br>
and 6 is strobe to mailstation.  pin 5 ("busy") will go<br>
high when the pc is talking to mailstation.<br>
<br>
The mailstation talks back to PC using pins<br>
15, 13, 12, 10, 11.  10 is ms busy, 11 is strobe<br>
to PC.<br>
<br>
Both sides raise busy when they want to talk, and<br>
both sides also raise busy briefly to acknowledge<br>
they have been strobed.<br>
<br>
You mentioned you had a rs232 tester, right?  It<br>
will tell you if your bits are getting out of the box,<br>
as long as it has leds for pins 5 & 6.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="9">9: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 24, 2005</p>
<p class="formattedBody">On Thu, 2005-03-24 at 07:53 +0000, Cyrano Jones wrote:<br>
<br>
Nope.<br>
<br>
I did buzz out my laplink cable; does this look correct/sufficient?:<br>
<br>
1-1<br>
2-15<br>
3-13<br>
4-12<br>
5-10<br>
6-11<br>
8-NC<br>
9-NC<br>
10-5<br>
11-6<br>
12-5<br>
13-3<br>
14-14<br>
15-NC<br>
16-16<br>
17-17<br>
18-NC<br>
19-NC<br>
20-NC<br>
21-NC<br>
22-NC<br>
24-NC<br>
24-NC<br>
25-25<br>
<br>
My serial mini-tester when hooked in doesn't show any activity. but it<br>
is only wired to show CD, DSR, RTS, TD, DTR, CTS, RD<br>
<br>
I tried just probing with a multi-meter... what should I should I hold<br>
the ground (black) probe to? I've just been touching it against the<br>
outer part of the connector.<br>
<br>
<br>
</p>
<hr><h3 id="10">10: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 24, 2005</p>
<p class="formattedBody">OOPS!  I was wrong when I said it worked unmodified.<br>
<br>
Your question about ground made me wonder what my tester<br>
was using for it's ground reference, since rs232 ground<br>
is pin 7, and pin 7 is not ground on the parport.<br>
<br>
I forgot about another little change I had made, before<br>
it worked at all.<br>
<br>
The common of the resistor pak in my rs232 tester was<br>
originally tied to pin 7 of the db25 (rs232 signal ground).<br>
<br>
I cut the trace between that common resistor pin and<br>
db25 pin 7 (it is connected to pin 7 of both db25's,<br>
so if you do this, make sure you cut it loose from both).<br>
<br>
Then I added a piece of kynar from that common resistor<br>
pin to one of the db 25 pins that is ground on the<br>
parallel port (I used pin 24, but pins 18 thru 25 are<br>
all ground on the PC parport.)<br>
<br>
<br>
I made some annotations on your pinout, below.<br>
Recheck those two, maybe its OK.<br>
<br>
My cable does not have the * connections, but<br>
several pinouts found on the 'net do.  I thought<br>
it odd that the  pin 1's would be connected straight<br>
thru, since pin 1 is an output on both sides.<br>
<br>
It turns out that those 4 pins are the control<br>
port (outputs).  I understand that they are<br>
open collector, so tying together is ok, and<br>
you can read as an input as long as you set<br>
the coresponding out bit high.<br>
(Mailstation doesn't use them)<br>
<br>
<br>
<br>
Here is how the laplink maps to a serial tester<br>
(need to make the ground mod to tester).<br>
<br>
At the PC end, the outputs to mailstation are:<br>
data 0 = pin 2 = TD<br>
data 1 = pin 3 = RD<br>
data 2 = pin 4 = RTS<br>
busy = pin 5 = CTS<br>
strobe = pin 6 = DSR<br>
<br>
The inputs do not fall on either of the other two LEDs.<br>
pin  8 = CD<br>
pin 20 = DTR<br>
<br>
<br>
I don't know if the shell of the connector is connected<br>
to the signal ground???  Likely is, but I am not sure.<br>
Pins 18 thru 25 are all signal ground though, so I would<br>
put black on one of them.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="11">11: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody">Well I've made a temporary retreat. Dealing with Linux and an unmodified<br>
mailstation is adding to many variables at once.<br>
<br>
I rebuilt my laptop with win98 and am using your current released binary<br>
from albatross.zip.<br>
<br>
So I run mailbug, enter u, then S<br>
<br>
I get "Mailstation did not ACK the dataflash command"<br>
<br>
So I was very brave and typed<br>
<br>
^f<br>
<br>
This does something!<br>
<br>
"The software update process is ready to start, please wait"<br>
<br>
appears on the mailstation screen, then immediately afterward it changes<br>
to "Please check that the mailstation cable is properly connected and<br>
try again."<br>
<br>
On the laptop DOS box I see<br>
<br>
Here we go....<br>
No codeflash command ACK, moderesult: 79<br>
Can't enter codeflash mode.<br>
<br>
The firmware revision on this unit is V3.03a. Nothing got hosed by the<br>
failed update attempt. The unit still works fine.<br>
<br>
<br>
</p>
<hr><h3 id="12">12: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody"><br>
Is this the same machine you were trying the Linux version on?<br>
<br>
<br>
If you type Ctrl-t (toggles debug mode) you will get more<br>
verbose info from most commands.  Here you would get<br>
the value of whatever the pc receives as acknowledge<br>
to the "enter dataflash mode" command.  The two<br>
values the ms might send are either #06 (ascii ACK),<br>
or #15 (ascii NAK).<br>
<br>
<br>
For codeflash mode, it displays the byte it receives in response<br>
to the command without "debug on", but it is in decimal here.<br>
Just one of many rough edges left to be smoothed.<br>
<br>
79  =  #4F  =  x01 001 111  is what you got,<br>
when we are expecting either<br>
ACK  =  #06  =  x00 000 110    or<br>
NAK  =  #15  =  x00 010 101<br>
where the x represents the unused bit of the third tribble.<br>
(bytes are sent as three groups of three bits.)<br>
<br>
Maybe it is a problem with the settling time on the port bits???<br>
Your cpu could be fast enough to read the port before they<br>
have had time to stabilize????  OR!  It could be that your<br>
low order bit of the three data bits is pegged high?????<br>
<br>
ACK is  x00 000 110    and if you set the lowest bit of each<br>
tribble high you get x01 001 111  =  #4F  =  79 dec.<br>
<br>
This will be easy enough to check.  Maybe I should add a<br>
loopback test???  Then you could make up a plug to feed<br>
the outs back into the ins on the parallel port.<br>
<br>
That way we can be sure we're talking to the port, without<br>
the mailstation (or cable) in the loop.<br>
<br>
I would not try to flash anything until I could read the<br>
serial number out reliably.  The SN command requires<br>
sending 12 bytes in (with checksum) and receiving<br>
18 bytes back.  With no danger if it fails.<br>
<br>
Erasing the codeflash takes just two bytes in.<br>
<br>
<br>
Also, until we see the code in 3.03a, we don't know if<br>
we are putting mboot in a location where it will be called<br>
for sure.  I had an idea to create an image that fills<br>
every high page with nops, and a jump to mboot at the<br>
end.  That way, wherever it jumps/calls will run mboot.<br>
<br>
HEY!!!  I just looked up the pin for your stuck bit, and it<br>
is 15, and that is one of the two that were wrong in<br>
your cable pinout.  Maybe your cable *is* bad!!!<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="13">13: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody">WIth Ctrl-T, and S (serial number) request I get<br>
<br>
Entering Dataflash mode...<br>
dataflash mode ack: 4F<br>
<br>
Mailstation did not ACK the dataflash command<br>
<br>
With ^f I get:<br>
<br>
Here we go........<br>
codeflash mode ack: 4F<br>
<br>
No codeflash command ACK, moderesult: 79<br>
Can't enter codeflash mode.<br>
<br>
Interestingly, if the mailstation is in this state "please check that<br>
the parallel cable..."<br>
<br>
And I do ^f again, I get<br>
<br>
Here we go........<br>
codeflash mode ack: 5D<br>
<br>
No codeflash command ACK, moderesult: 93<br>
Can't enter codeflash mode.<br>
<br>
On Fri, 2005-03-25 at 12:18 +0000, Cyrano Jones wrote:<br>
No. This is my athlon 1.3Ghz (I think) laptop.<br>
<br>
<br>
Crap, I think you're right... one way it's 15-2, the other way it's<br>
15-NC. Of course that would mean that behavior should be different<br>
connected the other way. Have to try that...<br>
<br>
Anyway I guess I'll build a damn cable. That's what I get for buying<br>
this 4 months ago and not doing anything with it...<br>
<br>
<br>
</p>
<hr><h3 id="14">14: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody">OK, better now.<br>
<br>
With Win98, I can now get the serial # from the unit. I bought a new<br>
laplink cable from Fry's, and this one doesn't have a dead 15-2<br>
connection so it works :-)<br>
<br>
As to Linux, I haven't tried it yet, but I have some theories: one, I<br>
don't know why I didn't think of this, but maybe the print server (lpd)<br>
is holding onto the port in some way. Which would cause some kind of<br>
problem. The deal is that I am able to share the printer port with my<br>
Rio PMP300 player, so I guess I didn't think about possible consequences<br>
of reusing the port.<br>
<br>
Alternatively, maybe I am writing to the port, but perhaps it is in some<br>
non standard mode, like epp mode? Does unit_tribble set the mode of the<br>
port?<br>
<br>
Now, I haven't tried the reflash command. 3.03a... not as brave now that<br>
I know I'm actually communicating... do you think I should just give it<br>
a shot, or do you have some ideas for an image that is more likely to<br>
work?<br>
<br>
<br>
</p>
<hr><h3 id="15">15: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody">On Fri, 2005-03-25 at 13:57 -0800, John R. Hogerhuis wrote:<br>
<br>
<br>
Never mind; I just went for it, and mailbug seems to be running now<br>
quite happily.<br>
<br>
Now what can I put on it... have as anyone tried compiling any programs<br>
for it? I was thinking about compiling some C code with sdcc and trying<br>
to run it on there.<br>
<br>
<br>
</p>
<hr><h3 id="16">16: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody"><br>
Great!!!  :-)   :-)   :-)<br>
<br>
programs<br>
trying<br>
<br>
So far, I have only used assembler, and not much more<br>
than the "hello world" (hello.asm & hello.hex)<br>
<br>
W hello.hex<br>
L 4000<br>
G 4000<br>
<br>
The source (and an assembler) is in the mbug directory.<br>
The mbug/mboot source is there, too.  I think I even<br>
zipped up the .bat file to build them.  The bat files<br>
need the dir set, I do that by just making "shortcuts"<br>
to the bat files (set properties to "close on exit").<br>
<br>
If you put the .hex or .rom files in the 253yr dir, you<br>
can load them without typing a path.  The bat files<br>
output the .hex or .rom's to 253yr, and .lst to mbug dir.<br>
<br>
I have started on a "next version" of mboot, but I am<br>
finding a few bugs in mailbug.  Load didn't work right<br>
always.  If you try to load a .rom over 256 bytes, it<br>
puts the bytes past 256 into the next page!!!  I got that<br>
fixed in mine.  I also discovered that the write to flash<br>
(Z) is broke.  I am still trying to get to the bottom of it.<br>
<br>
There has been a lot of change in the code since the last<br>
time I used Z command, so I am not sure how I broke it.<br>
I'd really like to fix that too, and then post a new<br>
mailbug.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="17">17: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 25, 2005</p>
<p class="formattedBody">On Sat, 2005-03-26 at 03:44 +0000, Cyrano Jones wrote:<br>
<br>
Thanks for your help debugging my setup :-)<br>
<br>
<br>
It looks like you've put together an excellent programmer's tool! I look<br>
forward to whatever improvements you can provide. For now though at<br>
least we all have a way to load code!<br>
<br>
I will let you know if I get the linux version working, maybe we can get<br>
some more people hacking on the MS if we get a stable set of tools for<br>
target development under Linux. From my end, I'd also like to get a<br>
"device" target (basically a C standard library) developed under sdcc.<br>
Sdcc can already generate Z80 code, but there of course is no MS target<br>
yet.<br>
<br>
Maybe in a few months we'll be able to completely replace the MS<br>
hardware access routines with our own.<br>
<br>
<br>
</p>
<hr><h3 id="18">18: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Mar 28, 2005</p>
<p class="formattedBody">wrote:<br>
[...]<br>
<br>
You're welcome!  Glad I could help!!!  :-)<br>
<br>
[....]<br>
[....]<br>
<br>
I have it figured out now.... Apparently you can't use code<br>
in one part of the flash to write to another part.  I thought<br>
as long as it was in a different sector it would be ok.  In<br>
retrospect, it seems kinda dumb to even try it.  I think<br>
the flash chip may be busy running it's internal programming<br>
algorithm, and all you are supposed to do is try to read back<br>
the byte you are attempting to flash.  You probably cannot<br>
access any other location till it's done!<br>
<br>
In the earliest versions, I just copied the rom to ram,<br>
like the ms does, and then I called the sector write<br>
from mbug.<br>
<br>
While experimenting with writing text to the LCD, I had<br>
mbug map the update code directly into Slot8000 (the only<br>
fonts left after reflash are in that update code).<br>
The LCD routines worked fine that way, running directly<br>
from the rom.  (I have a halfway-decent scrolling text<br>
screen, now!)<br>
<br>
It only seemed natural to just use the sector write the<br>
same way...<br>
<br>
I was lazy, and didn't want to rewrite what seemed good<br>
enough.  I think the right way to do it now is just add<br>
the actual flash code into mbug.<br>
<br>
look<br>
<br>
:-)<br>
<br>
I may have something better in a few days, but for now, if anyone is<br>
tying to use it, as far a I can tell the hex file load is working ok<br>
in the old version (what number did I post, 0.0.1 or 0.0.2 ????).<br>
You can assemble a file (orged #4000) to a .hex file, load it<br>
at #4000, (L 4000) and then execute it with the go command<br>
(G 4000).<br>
<br>
<br>
I have a hunch you were closer than you realized!!!    ;^)<br>
<br>
for<br>
sdcc.<br>
target<br>
[.....]<br>
<br>
I am looking forward to seeing what other people might be able<br>
to get going.  As far as the C standard library, I think that is<br>
what most of the low level mailstation code is.<br>
<br>
I have done some experiments where I have made calls to<br>
several of the low level routines.  I've been imagining making<br>
an include-file for the assembler, with the EQU's for the<br>
usefull addresses.  Is this the kind of thing you would<br>
use a c "header file" for???<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="19">19: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Mar 31, 2005</p>
<p class="formattedBody">On Tue, 2005-03-29 at 01:08 +0000, Cyrano Jones wrote:<br>
<br>
<br>
Interesting. I guess I never realized that about industrial flash<br>
chips... now that I think about it, the only time I've ever written to<br>
it was while running from RAM. So I'd say this behavior kind of stinks,<br>
but I don't doubt it to be the case. Certainly you would think that<br>
other sectors would be unaffected by a write to another sector, but I<br>
guess they aren't that sophisticated.<br>
<br>
<br>
Cool!<br>
<br>
<br>
I agree.<br>
<br>
[...]<br>
<br>
<br>
Yes, I agree. But it will be nice to have a complete independent set of<br>
firmware, then we will know we have a foundation that can't be changed<br>
under us.<br>
<br>
<br>
Yes, a header file and possibly a C wrapper library to go with it,<br>
depending on the calling conventions of the low level routines.<br>
<br>
<br>
</p>
<hr><h3 id="20">20: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Apr 1, 2005</p>
<p class="formattedBody">[....]<br>
to<br>
stinks,<br>
I<br>
<br>
The datasheet doesn't directly say that you can't do this,<br>
but it is the only explanation I can think of.  The symptom<br>
was that mbug rebooted when I tried either erase or flash<br>
operations.  The sector would be erased ok, but when trying<br>
to flash, only one byte would be flashed.  Thats consistent<br>
with what I would expect if the cpu lost access to the code<br>
it was running after issuing the erase or byte program commands.<br>
<br>
[....]<br>
<br>
I uploaded my test program here:<br>
<a target="_blank" href="http://groups.yahoo.com/group/mailstation/files/Mailbug/scancode/">(URL)</a><br>
<br>
It reads the keyboard, and displays the key scancode on the LCD.<br>
<br>
<br>
That I'm lazy, or about the right way to do it???  :-)  :-)  :-)<br>
<br>
[...]<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="21">21: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Apr 8, 2005</p>
<p class="formattedBody">wrote:<br>
<br>
I wasn't as lucky.  I went to office max last nite, and grabbed<br>
a few of the $9.00 150's.  Just now, my curiosity got the better<br>
of me, and I flashed the 0.0.2 mbug into one of them.<br>
<br>
It seems that it flashed it ok, but when it rebooted, I got a<br>
streak of bits written to the lcd (approx the top half inch of<br>
the lcd).  That might indicate that the loader ran, and copied<br>
the mboot code to ram (it gets loaded into what normaly is the<br>
lcd buffer).  But it is not supposed to write the buffer to the<br>
lcd.  And it never turned on the "new mail" LED (one of the first<br>
things mboot does when it starts running after being copied to ram.<br>
<br>
Or, it could just be the cpu walking thru the screen ram.  The<br>
pattern does not seem to match the mboot code.<br>
<br>
I stopped thinking about the idea of a "safer" image after your<br>
success with 3.03a, but maybe I will have to get back to it.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="22">22: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Apr 8, 2005</p>
<p class="formattedBody">On Fri, 2005-04-08 at 11:30 +0000, Cyrano Jones wrote:<br>
<br>
<br>
Hmm... what version is in the 150? Mine is something like 4.x.<br>
<br>
Anyway, I guess the good news is the reflash code is there, so at least<br>
they can talk. Just need to remove the debugger's dependency on the boot<br>
rom.<br>
<br>
<br>
</p>
<hr><h3 id="23">23: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Neil Morrison" &lt;neilsmorr@...></p>
<p class="date">Apr 8, 2005</p>
<p class="formattedBody">From: "John R. Hogerhuis" &lt;jhoger@...><br>
<br>
<br>
I gather there's no code in the ROM to dump the ROM out?<br>
<br>
Neil<br>
<br>
</p>
<hr><h3 id="24">24: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Apr 9, 2005</p>
<p class="formattedBody">wrote:<br>
<br>
<br>
It was 4.somethin D, but it's kind of hard to tell now!  :-)<br>
I have another that is 4.05D, so I imagine that first one was, too.<br>
<br>
<br>
Right, it does seem to use the same reflash protocol.<br>
<br>
I have been thinking about just how to organize the next version<br>
of the mbug/mboot code.  (mboot is what I have been calling the<br>
code that gets flashed into the ms codeflash, mbug is code that is<br>
loaded into ms RAM via laplink, and mailbug is what I am calling<br>
the debugger that runs on the PC at the other end of the laplink.)<br>
<br>
It seems it would be good to minimize the number of times you had<br>
to risk losing access when flashing new code, but it would be nice<br>
to be able to make changes, too.<br>
<br>
The old code does this by loading the latest version into ram from<br>
the PC host.  (Which also means you need the PC attached whenever<br>
you reboot the mailstation.)<br>
<br>
But eventually it would be nice to be able to run without the<br>
PC/laplink.<br>
<br>
I am thinking that the next step might be a simple ROM monitor that<br>
would let you run code at arbitrary locations in the codeflash, from<br>
the ms keyboard, as well as connecting to the PC based debugger.<br>
<br>
And to allow you to develop new versions of the monitor, and flash<br>
them without the white knuckles, that it would be seperated into<br>
two parts.  The first would go in page #00 and remain unchanged<br>
mostly.  It would be able to automatically jump into the second<br>
stage, which would be in a higher page that was eraseable separately<br>
from the first stage.<br>
<br>
Then, if (or should I say when!) you hosed that second stage with a<br>
careless change, you could hold a key on the ms keyboard while<br>
rebooting it.  That would make the first stage skip the auto-jump,<br>
and instead let you load mbug into ram, so you could fix the second<br>
stage with the debugger.<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="25">25: Subject: Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "Cyrano Jones" &lt;cyranojones_lalp@...></p>
<p class="date">Apr 9, 2005</p>
<p class="formattedBody">wrote:<br>
<br>
<br>
That's right.  At least a way has not been found yet, without<br>
desoldering the chip, or doing other board surgery.<br>
<br>
There is really no reason that the manufacturer would ever<br>
need to dump the rom, so the function is not there.<br>
<br>
That makes it more dificult to interface to the existing code, but<br>
not impossible.  I expect that before long we will be able to load<br>
and run our own code in all except the 350's.  (Not that it would<br>
be impossible, just that as far as I know, nobody is even working<br>
on the 350.)<br>
<br>
CJ<br>
<br>
</p>
<hr><h3 id="26">26: Subject: Re: [mailstation] Re: mbug</h3>
<a href="#0">(top)</a><p class="from">From: "John R. Hogerhuis" &lt;jhoger@...></p>
<p class="date">Apr 9, 2005</p>
<p class="formattedBody">On Sat, 2005-04-09 at 11:06 +0000, Cyrano Jones wrote:<br>
<br>
OK, I'll try to use those names.<br>
<br>
<br>
Yeah, most systems I've worked on have a boot sector/loader that almost<br>
never changes. Comes up in bootloader, looks around a flash file system<br>
for the application, loads it to RAM, checksums it, and if its OK, jumps<br>
to it.<br>
<br>
You have to add some kind of override... keyboard in our case, that<br>
allows you to erase a bad application, so that you don't get into a bad<br>
situation if the application is 'bad' even though the checksum is ok.<br>
<br>
<br>
Yes a a simple standalone debugger would be nice. Another possibility is<br>
to integrate this Forth interpreter:<br>
<br>
<a target="_blank" href="http://www.zetetics.com/camel/">(URL)</a><br>
<br>
Then high level code can be written on the MS itself, a simple Forth<br>
assembler could be integrated, etc.<br>
<br>
To adapt a Forth usually all you have to do is adapt KEY and EMIT to the<br>
system so you do I/O. If we want to run the Forth directly from ROM<br>
rather than RAM, we might be able to get some pointers from the Z88<br>
CamelForth project since it can run directly from ROM.<br>
<br>
<br>
Yeah a simple boot loader that can either find a second stage and<br>
checksum it, or load and checksum an app directly to RAM if the second<br>
stage either doesn't checksum or the user intervenes. I guess MBUG<br>
qualifies as a loadable app, and mboot is the boot loader. Mailbug is<br>
pretty much your typical target debugger. But if we can get Forth loaded<br>
on there as the loaded app, I think it might be cool to develop new code<br>
right on MS.<br>
<br>
<br>
Yep. With the addition that we should probably checksum the second<br>
stage.<br>
<br>
<br>
</p>

</div>
</body>
</html>